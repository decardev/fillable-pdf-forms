% !TeX root = ./prostate.tex

\startcomponent cmp_scripts
  \product prostate

	\startJSpreamble {INITIAL} used now
		
		const PTV: [
			{
				name: "PTV_PR",
				mode: [
					{
						name: "Normo 31x240",
						spec: { dose: 7440,fxrt: 240, fxnm: 31 },
						dvh: ["V7440 cGy", "\u2265", "95\%", "", "", "", "", "", ""],
					}	
				]
			}, 
			{
				name: "PTV_VS 31x180",
				mode: [
					{
						name: "Normo", 
						spec: { dose: 5580, fxrt: 180, fxnm: 31 },
						dvh: ["V5580 cGy", "\u2265", "95\%", "", "", "", "", "", ""],
					} 
				]
			},  
			{
				name: "PTV_VS",
				mode: [
					{
						name: "Normo",
						spec: { dose: 5270,fxrt: 170, fxnm: 31 },
						dvh: ["V5270 cGy", "\u2265", "95\%", "", "", "", "", "", ""],
					}	
				]
			}, 
			{
				name: "PTV_LN+",
				mode: [
					{
						name: "Normo", 
						spec: { dose: 5580, fxrt: 180, fxnm: 31 },
						dvh: ["V5580 cGy", "\u2265", "95\%", "", "", "", "", "", ""],
					} 
				]
			}
		]

		const OAR: [
			{ 
				name: "CABEZAS FEMORALES", 
				dvh: [" ", "V5000 cGy < 5\% (10\%)", "DMax < 5200 cGy"] 
			},
			{ 
				name: "RECTO", 
				dvh: [" ", "V7000 cGy < 10\% (20\%)", "V4000 cGy < 45\%", "V5300 cGy < 35\%"]        
			},
			{	
				name: "VEJIGA", 
				dvh: [" ", "V7000 cGy < 10\% (20\%)", "V6100 cGy < 53\%", "V5700 cGy < 50\%"]
			}, 
			{
				name: "BULBO", 
				dvh: [" ", "V4400 cGy < 50\%", "DMean < 5000 cGy"]
			},
			{
				name: "INTESTINO", 
				dvh: [" ", "V5000 cGy < 1 cc", "V3900 cGy < 195 cc", "V4500 cGy < 150 cc"]
			},
			{
				name: "ANO", 
				dvh: [" ", "V3100 cGy < 60\%", "V3500 cGy < 40\%"]  
			}, 
			{
				name: "PENE",
				dvh: [" ", "V3000 cGy < 1 cc"]
			},
			{
				name: "TESTICULOS",
				dvh: [" ", "V300 cGy < 0.03 cc"]
			}
		], 

		const DVH: [
			{
				name: "Normo"
				spec: [
					{ oar: 0, dvh: [1] },
					{ oar: 1, dvh: [1] },
					{ oar: 2, dvh: [1] },
					{ oar: 3, dvh: [1] },
					{ oar: 4, dvh: [1] },
					{ oar: 5, dvh: [1] },
					{ oar: 6, dvh: [1] },
					{ oar: 7, dvh: [1] },
					{ oar: 8, dvh: [1] }
				]
			}
		]

		const DATA = {
			PTV: 
			OAR: [
				{ 
					name: "CABEZAS FEMORALES", 
					dvh: [" ", "V5000 cGy < 5\% (10\%)", "DMax < 5200 cGy"] 
				},
				{ 
					name: "RECTO", 
					dvh: [" ", "V7000 cGy < 10\% (20\%)", "V4000 cGy < 45\%", "V5300 cGy < 35\%"]        
				},
				{	
					name: "VEJIGA", 
					dvh: [" ", "V7000 cGy < 10\% (20\%)", "V6100 cGy < 53\%", "V5700 cGy < 50\%"]
				}, 
				{
					name: "BULBO", 
					dvh: [" ", "V4400 cGy < 50\%", "DMean < 5000 cGy"]
				},
				{
					name: "INTESTINO", 
					dvh: [" ", "V5000 cGy < 1 cc", "V3900 cGy < 195 cc", "V4500 cGy < 150 cc"]
				},
				{
					name: "ANO", 
					dvh: [" ", "V3100 cGy < 60\%", "V3500 cGy < 40\%"]  
				}, 
				{
					name: "PENE",
					dvh: [" ", "V3000 cGy < 1 cc"]
				},
				{
					name: "TESTICULOS",
					dvh: [" ", "V300 cGy < 0.03 cc"]
				}
			], 
			DVH: [
				{
					name: "Normo"
					spec: [
						{ oar: 0, dvh: [1] },
						{ oar: 1, dvh: [1] },
						{ oar: 2, dvh: [1] },
						{ oar: 3, dvh: [1] },
						{ oar: 4, dvh: [1] },
						{ oar: 5, dvh: [1] },
						{ oar: 6, dvh: [1] },
						{ oar: 7, dvh: [1] },
						{ oar: 8, dvh: [1] }
					]
				}
			]

		}
			
		function fHelv(num, field = this.event.target){
			field.textFont = font.Helv;
			field.textSize = num;
		}		
		
		function fPopupFocus(){
			this.event.target.setFocus();
		}


		function fOARPopup(){
			var field = getField("df_OAR_LIST");
	
			field.setItems([...DATA.OAR.mode.map(item => item.name), " "]);
			field.value = " ";
			fHelv(9, field);
		}

		function fRegOAR(){
			for (var i=0; i <= 8; i++){
				var name = "df_OAR" + i;
				getField(name + "_NAME").value = DATA.OAR.mode[0].spec[i].name;
				for (var j=0; j<=2; j++){
					var field = getField(name + "_DVH" + j);
					field.value = DATA.OAR.mode[0].spec[i].dvh[j];
					fHelv(7, field);
				}
			}
		}


		function fMakeDate(name){
			const field = getField(name);
			const cFormat = "dd/mm/yyyy";
			field.setAction("Format", "AFDate_FormatEx(\""+cFormat+"\")");
			field.setAction("Keystroke", "AFDate_KeystrokeEx(\""+cFormat+"\")");
		}
		
		fMakeDate("df_START_DATE");
		fOARPopup();
		fRegOAR();

	\stopJSpreamble

\stopcomponent
